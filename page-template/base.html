<!--
SPDX-License-Identifier: GPL-3.0-or-later
SynapSeq Hub Frontend Template
Copyright (C) 2025 SynapSeq Project Contributors

This file is part of SynapSeq Hub.
Licensed under the GNU General Public License v3.0 or later.
See the LICENSE_CODE file for full license text.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SynapSeq Hub</title>
    <link rel="icon" type="image/x-icon" href="static/favicon.ico" />
    <link rel="stylesheet" href="static/style.css" />
  </head>
  <body class="light">
    <header>
      <div class="header-title">
        <img src="static/logo.png" alt="SynapSeq Logo" class="logo" />
        <h1>SynapSeq Hub</h1>
      </div>
      <button id="themeToggle" class="theme-toggle">Dark Mode</button>
    </header>

    <div id="stats">
      <p><strong>Total sequences:</strong> {{total}}</p>
      <p><strong>Official:</strong> {{official}}</p>
      <p><strong>Community:</strong> {{community}}</p>
      <p>
        <strong>Last updated:</strong>
        <span
          id="lastUpdated"
          data-timestamp="{{last_updated}}"
          title="{{last_updated}}"
        >
          {{last_updated}}
        </span>
      </p>
    </div>

    <div class="search-wrapper">
      <input type="text" id="search" placeholder="Search sequences..." />
      <button
        id="clearSearch"
        class="clear-search"
        onclick="clearSearch()"
        style="display: none"
      >
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path
            d="M12 4L4 12M4 4l8 8"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </button>
    </div>

    <table id="seqTable">
      <thead>
        <tr>
          <th>Category</th>
          <th>Name</th>
          <th>Author</th>
        </tr>
      </thead>
      <tbody>
        {{rows}}
      </tbody>
    </table>

    <div id="viewer" style="display: none">
      <button class="back-btn" onclick="backToList()">< Back</button>

      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading sequence...</p>
      </div>

      <div id="seqMeta">
        <div class="cli-command">
          <p><strong>Run this sequence via CLI:</strong></p>
          <div class="cli-wrapper">
            <code id="cliCommand"></code>
            <button
              id="copyBtnDesktop"
              class="copy-btn copy-btn-desktop"
              onclick="copyCommand()"
            >
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <rect
                  x="4"
                  y="4"
                  width="8"
                  height="10"
                  rx="1"
                  stroke="currentColor"
                  stroke-width="1.5"
                />
                <path
                  d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                  stroke="currentColor"
                  stroke-width="1.5"
                />
              </svg>
              <span>Copy</span>
            </button>
          </div>
          <button
            id="copyBtnMobile"
            class="copy-btn copy-btn-mobile"
            onclick="copyCommand()"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <rect
                x="4"
                y="4"
                width="8"
                height="10"
                rx="1"
                stroke="currentColor"
                stroke-width="1.5"
              />
              <path
                d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                stroke="currentColor"
                stroke-width="1.5"
              />
            </svg>
            <span>Copy</span>
          </button>
        </div>

        <div id="seqDescription" style="display: none">
          <h3>Description</h3>
          <div id="descriptionContent" class="description-content"></div>
          <button
            id="toggleDescription"
            class="read-more-btn"
            onclick="toggleDescription()"
            style="display: none"
          >
            Read more
          </button>
        </div>
      </div>

      <div id="dependenciesSection" style="display: none">
        <button
          id="toggleDependencies"
          class="toggle-dependencies-btn"
          onclick="toggleDependencies()"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            class="chevron"
          >
            <path
              d="M4 6l4 4 4-4"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <span>Show dependencies</span>
        </button>
        <div id="seqInfo" style="display: none"></div>
      </div>

      <div id="sourceCodeSection" style="display: none">
        <button
          id="toggleSourceCode"
          class="toggle-source-btn"
          onclick="toggleSourceCode()"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            class="chevron"
          >
            <path
              d="M4 6l4 4 4-4"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <span>Show source code</span>
        </button>
        <pre id="seqCode" style="display: none"></pre>
      </div>

      <div id="buttons">
        <button id="downloadZipBtn" onclick="handleDownloadClick()">
          Download Sequence
        </button>
      </div>
    </div>

    <!-- Download Modal -->
    <div id="downloadModal" class="modal" style="display: none">
      <div class="modal-content">
        <button class="modal-close" onclick="closeDownloadModal()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path
              d="M15 5L5 15M5 5l10 10"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </button>

        <h2>Download Instructions</h2>

        <div class="instructions">
          <h3>After downloading, follow these steps:</h3>

          <div class="step">
            <span class="step-number">1</span>
            <div class="step-content">
              <p><strong>Extract the ZIP file:</strong></p>
              <p class="step-label">Windows (PowerShell):</p>
              <div class="code-wrapper">
                <code id="unzipWindows"></code>
                <button
                  class="copy-code-btn"
                  onclick="copyCode('unzipWindows')"
                >
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <rect
                      x="4"
                      y="4"
                      width="8"
                      height="10"
                      rx="1"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                    <path
                      d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                  </svg>
                </button>
              </div>
              <p class="step-label">macOS / Linux:</p>
              <div class="code-wrapper">
                <code id="unzipUnix"></code>
                <button class="copy-code-btn" onclick="copyCode('unzipUnix')">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <rect
                      x="4"
                      y="4"
                      width="8"
                      height="10"
                      rx="1"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                    <path
                      d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <div class="step">
            <span class="step-number">2</span>
            <div class="step-content">
              <p><strong>Navigate to the extracted folder:</strong></p>
              <div class="code-wrapper">
                <code id="cdCommand"></code>
                <button class="copy-code-btn" onclick="copyCode('cdCommand')">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <rect
                      x="4"
                      y="4"
                      width="8"
                      height="10"
                      rx="1"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                    <path
                      d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <div class="step">
            <span class="step-number">3</span>
            <div class="step-content">
              <p><strong>Generate the WAV file:</strong></p>
              <div class="code-wrapper">
                <code id="generateCommand"></code>
                <button
                  class="copy-code-btn"
                  onclick="copyCode('generateCommand')"
                >
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <rect
                      x="4"
                      y="4"
                      width="8"
                      height="10"
                      rx="1"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                    <path
                      d="M12 4V2.5C12 1.67 11.33 1 10.5 1H5.5C4.67 1 4 1.67 4 2.5V4"
                      stroke="currentColor"
                      stroke-width="1.5"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <button id="downloadBtn" class="download-btn" onclick="downloadZip()">
          <span id="downloadBtnText"
            >Download starting in <strong id="countdownText">3</strong>...</span
          >
        </button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="static/main.js"></script>
  </body>
</html>
